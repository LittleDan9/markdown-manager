// styles.scss

// ─── GLOBAL RESET ───
html,
body {
  height: 100%;
  margin: 0;
}

// ─── CONTAINER: Fill the entire viewport ───
#container {
  display: flex;
  flex-direction: column;
  height: 100vh; // exactly the browser’s viewport height

  // ─── TOOLBAR (≈56px tall by default) ───
  #toolbar {
    flex: 0 0 auto;
  }

  // ─── MAIN AREA: fill everything below the toolbar ───
  #main {
    display: flex;
    flex: 1 1 auto; // share 100vh minus toolbar, shrink/grow if needed
    min-height: 0;  // allow its children to shrink
    overflow: hidden;

    // ─── LEFT EDITOR PANE (40% width) ───
    #editorContainer {
      flex: 0 0 40%;       // exactly 40% of #main’s width
      height: 100%;        // fill #main’s height
      display: flex;
      flex-direction: column;
      min-height: 0;       // allow #editor to shrink/grow inside
      border-top-left-radius: 0.5rem;
      border-bottom-left-radius: 0.5rem;
      padding: 1rem;
      box-sizing: border-box;

      #editor {
        flex: 1 1 auto;   // fill entire height of #editorContainer
        border: 1px solid #ced4da;
        border-radius: 0.5rem;
        overflow: hidden; // Monaco editor will handle its own scrolling
      }
    }

    // ─── RIGHT PREVIEW PANE (60% width) ───
    #previewContainer {
      flex: 0 0 60%;       // exactly 60% of #main’s width
      height: 100%;        // fill #main’s height
      display: flex;       // center #preview inside it
      justify-content: center;
      align-items: center;
      // background-color: #ffffff;
      min-height: 0;       // allow #preview to shrink/grow
      padding: 1rem;
      /* Optionally, if you want a dropped‐shadow around the preview: */
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);

      #preview {
        width: 100%;
        height: 100%;
        display: flex;       // center its children (the Mermaid SVG)
        flex-direction: column;
        border-radius: 0.5rem;
        border: #ced4da 1px solid;
        padding: 0.25rem;
        box-sizing: border-box;
      }

      .preview-scroll {
        flex: 1 1 auto; // allow the preview to grow/shrink
        overflow: auto;
        border-radius: inherit;
        min-height: 0;
        padding: 1rem;
        word-wrap: break-word;
        overflow-wrap: break-word;
        hyphens: auto;

        // Ensure content doesn't overflow horizontally
        max-width: 100%;

        // Handle long lines in all content
        * {
          max-width: 100%;
          word-wrap: break-word;
          overflow-wrap: break-word;
        }

        // Special handling for code blocks and pre elements
        pre, code {
          white-space: pre-wrap;
          word-wrap: break-word;
          overflow-wrap: break-word;
          overflow-x: auto;
          max-width: 100%;
        }

        // Inline code should wrap
        code:not(pre code) {
          white-space: normal;
          word-break: break-all;
        }

        // Tables should be scrollable horizontally
        table {
          display: block;
          max-width: 100%;
          overflow-x: auto;
          white-space: nowrap;
        }

        // Long URLs and links should break
        a {
          word-break: break-all;
          overflow-wrap: break-word;
        }
      }
    }
  }
}

// ─── Monaco Editor Rounding (unchanged) ───
.monaco-editor,
.monaco-editor .overflow-guard {
  border-radius: 0.5rem;
}


.code-block {
  position: relative;
  margin: 2rem 0;
  border: 1px solid #e1e1e1;
  border-radius: 4px;
  overflow: hidden;

  [data-bs-theme="dark"] & {
    border-color: #444;
  }
}

.code-block-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.5rem 1rem;
  background-color: #f5f5f5;
  border-bottom: 1px solid #e1e1e1;
  font-size: 0.875rem;
  font-weight: 500;
  margin: 0;

  [data-bs-theme="dark"] & {
    background-color: #2a2a2a;
    border-bottom-color: #444;
    color: #fff;
  }
}

.code-block-lang {
  text-transform: uppercase;
  color: #333;
  padding: 0;
  [data-bs-theme="dark"] & {
    color: #ccc;
  }
}

.code-block-copy-btn {
  background: none;
  border: none;
  padding: 0.25rem 0.5rem;
  cursor: pointer;
  display: flex;
  align-items: center;
  color: #333;
  transition: color 0.2s ease;

  &:hover {
    color: #007bff;
  }

  [data-bs-theme="dark"] & {
    color: #ccc;
    
    &:hover {
      color: #66b0ff;
    }
  }

  i {
    font-size: 1rem;
  }

  &[data-prismjs-copy].prism-copy-to-clipboard--copied::after {
    content: 'Copied!';
    margin-left: 0.5rem;
    font-size: 0.875rem;
    color: #007bff;
    [data-bs-theme="dark"] & {
      color: #66b0ff;
    }
  }
}

// Style Prism.js code blocks
pre[class*="language-"] {
  margin: 0 !important;
  padding: 1rem;
  border-radius: 0 0 4px 4px;
  background: transparent; // Let Prism.js theme handle background
  overflow-x: auto;
  max-width: 100%;
  white-space: pre-wrap;
  word-wrap: break-word;
  overflow-wrap: break-word;

  // Ensure code inside pre also wraps
  code {
    white-space: pre-wrap;
    word-wrap: break-word;
    overflow-wrap: break-word;
  }
}

// Style plain code blocks (without language highlighting)
pre:not([class*="language-"]) {
  margin: 0 !important; // Ensure no margin - container provides it
  padding: 1rem;
  border: none; // No border - container provides it
  border-radius: 0 0 4px 4px; // Bottom rounded corners to match Prism.js
  background: hsl(230, 1%, 98%); // Match Prism.js One Light theme exactly
  color: hsl(230, 8%, 24%); // Match Prism.js One Light text color
  overflow: hidden;
  max-width: 100%;
  white-space: pre-wrap;
  word-wrap: break-word;
  overflow-wrap: break-word;
  font-family: "Fira Code", "Fira Mono", Menlo, Consolas, "DejaVu Sans Mono", monospace;
  font-size: 0.875rem;
  line-height: 1.45;

  [data-bs-theme="dark"] & {
    background: hsl(220, 13%, 18%); // Match Prism.js One Dark theme exactly
    color: hsl(220, 14%, 71%); // Match Prism.js One Dark text color
  }
}

// Style inline code
code:not(pre code):not([class*="language-"]) {
  padding: 0.125rem 0.25rem;
  background-color: #f8f9fa;
  border: 1px solid #e9ecef;
  border-radius: 0.25rem;
  font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
  font-size: 0.875em;
  color: #e83e8c;

  [data-bs-theme="dark"] & {
    background-color: #2d3748;
    border-color: #4a5568;
    color: #f92672;
  }
}

// ─── DOCUMENT MANAGEMENT STYLES ───

// PDF Export - Dark mode with good contrast
.pdf-export-mode {
  &[data-theme="dark"] {
    color: #ffffff !important;
    background-color: #1a1a1a !important;

    * {
      color: #ffffff !important;
    }

    .preview-scroll {
      background-color: #1a1a1a !important;
      color: #ffffff !important;
    }

    // Dark theme code blocks with good contrast
    pre[class*="language-"] {
      background-color: #2d2d2d !important;
      color: #f8f8f2 !important;
      border: 1px solid #444 !important;
    }

    code:not([class*="language-"]) {
      background-color: #2d2d2d !important;
      color: #f92672 !important;
      padding: 0.125rem 0.25rem !important;
      border-radius: 0.25rem !important;
    }

    // Mermaid diagrams with dark theme
    .mermaid {
      background-color: #2d2d2d !important;
      border: 1px solid #444 !important;
      border-radius: 0.25rem !important;
      padding: 1rem !important;

      * {
        fill: #ffffff !important;
        stroke: #ffffff !important;
        color: #ffffff !important;
      }

      // Specific mermaid elements
      .node rect, .node polygon, .node circle, .node ellipse {
        fill: #444 !important;
        stroke: #ffffff !important;
      }

      .edgePath path {
        stroke: #ffffff !important;
      }

      .edgeLabel {
        background-color: #2d2d2d !important;
        color: #ffffff !important;
      }
    }

    // Tables with dark theme
    table {
      color: #ffffff !important;
      background-color: #2d2d2d !important;
      border: 1px solid #444 !important;

      th, td {
        border-color: #444 !important;
        background-color: #2d2d2d !important;
        color: #ffffff !important;
      }

      thead th {
        background-color: #404040 !important;
        color: #ffffff !important;
      }
    }

    // Headings
    h1, h2, h3, h4, h5, h6 {
      color: #ffffff !important;
      border-bottom-color: #444 !important;
    }

    // Links
    a {
      color: #66b3ff !important;

      &:hover {
        color: #99ccff !important;
      }
    }

    // Blockquotes
    blockquote {
      color: #cccccc !important;
      border-left: 4px solid #666 !important;
      background-color: #2d2d2d !important;
      padding: 1rem !important;
      margin: 1rem 0 !important;
    }

    // Horizontal rules
    hr {
      border-color: #444 !important;
    }

    // Lists
    ul, ol {
      color: #ffffff !important;
    }

    // Strong and emphasis
    strong, b {
      color: #ffffff !important;
      font-weight: bold !important;
    }

    em, i {
      color: #cccccc !important;
      font-style: italic !important;
    }
  }

  // Light mode export (kept for reference)
  &[data-theme="light"] {
    color: #212529 !important;
    background-color: #ffffff !important;

    * {
      color: inherit !important;
    }

    .preview-scroll {
      background-color: #ffffff !important;
      color: #212529 !important;
    }

    // Light theme code blocks
    pre[class*="language-"] {
      background-color: #f8f9fa !important;
      color: #212529 !important;
    }

    code {
      background-color: #f8f9fa !important;
      color: #e83e8c !important;
    }

    // Light theme mermaid diagrams
    .mermaid {
      background-color: #ffffff !important;

      * {
        fill: #000000 !important;
        stroke: #000000 !important;
        color: #000000 !important;
      }
    }

    // Tables
    table {
      color: #212529 !important;
      background-color: #ffffff !important;

      th, td {
        border-color: #dee2e6 !important;
        background-color: transparent !important;
      }
    }

    // Headings
    h1, h2, h3, h4, h5, h6 {
      color: #212529 !important;
    }

    // Links
    a {
      color: #0d6efd !important;
    }

    // Blockquotes
    blockquote {
      color: #6c757d !important;
      border-left-color: #dee2e6 !important;
    }
  }
}

// Document title styling
#documentTitle {
  cursor: pointer;
  padding: 0.25rem 0.5rem;
  border-radius: 0.25rem;
  transition: background-color 0.2s ease;

  &:hover {
    background-color: rgba(0, 0, 0, 0.05);
  }

  &.editing {
    background-color: #fff;
    border: 1px solid #007bff;
    outline: none;

    [data-bs-theme="dark"] & {
      background-color: #2a2a2a;
      border-color: #66b0ff;
      color: #fff;
    }
  }

  [data-bs-theme="dark"] & {
    &:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }
  }
}

// Document list styles
.document-list {
  .document-item {
    &:hover {
      background-color: rgba(0, 0, 0, 0.05);
    }

    [data-bs-theme="dark"] & {
      &:hover {
        background-color: rgba(255, 255, 255, 0.05);
      }
    }
  }
}

// Notification styles
.notification {
  animation: slideIn 0.3s ease-out;

  @keyframes slideIn {
    from {
      transform: translateX(100%);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }
}

.subtle-notification {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  font-weight: 500;
  letter-spacing: 0.025em;
}

// File menu button styling
.dropdown-toggle {
  &:focus {
    box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
  }
}

// Dropdown menu improvements
.dropdown-menu {
  &.show {
    display: block;
  }

  // Ensure dropdown is visible
  &:not(.show) {
    display: none;
  }

  // Position dropdown properly
  position: absolute;
  top: 100%;
  left: 0;
  z-index: 1000;
  min-width: 10rem;
  padding: 0.5rem 0;
  margin: 0.125rem 0 0;
  font-size: 0.875rem;
  color: #212529;
  text-align: left;
  background-color: #fff;
  border: 1px solid rgba(0, 0, 0, 0.175);
  border-radius: 0.375rem;
  box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.175);

  [data-bs-theme="dark"] & {
    color: #dee2e6;
    background-color: #212529;
    border-color: #495057;
  }

  .dropdown-item {
    display: block;
    width: 100%;
    padding: 0.25rem 1rem;
    clear: both;
    font-weight: 400;
    color: #212529;
    text-align: inherit;
    text-decoration: none;
    white-space: nowrap;
    background-color: transparent;
    border: 0;
    cursor: pointer;

    &:hover,
    &:focus {
      color: #1e2125;
      background-color: #e9ecef;
    }

    [data-bs-theme="dark"] & {
      color: #dee2e6;

      &:hover,
      &:focus {
        color: #fff;
        background-color: #495057;
      }
    }
  }

  .dropdown-divider {
    height: 0;
    margin: 0.5rem 0;
    overflow: hidden;
    border-top: 1px solid rgba(0, 0, 0, 0.175);

    [data-bs-theme="dark"] & {
      border-top-color: #495057;
    }
  }
}

// Modal improvements
.modal-content {
  border-radius: 0.5rem;
  border: none;
  box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
}

.modal-header {
  border-bottom: 1px solid #dee2e6;
  border-top-left-radius: 0.5rem;
  border-top-right-radius: 0.5rem;

  [data-bs-theme="dark"] & {
    border-bottom-color: #444;
    background-color: #2a2a2a;
    color: #fff;
  }
}

.modal-body {
  [data-bs-theme="dark"] & {
    background-color: #1a1a1a;
    color: #fff;
  }
}

.modal-footer {
  border-top: 1px solid #dee2e6;
  border-bottom-left-radius: 0.5rem;
  border-bottom-right-radius: 0.5rem;

  [data-bs-theme="dark"] & {
    border-top-color: #444;
    background-color: #2a2a2a;
  }
}

// Custom Modal Implementation - Higher specificity to override Bootstrap
body .custom-modal {
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  width: 100% !important;
  height: 100% !important;
  z-index: 1060 !important; // Higher than Bootstrap's modal z-index
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  opacity: 0 !important;
  visibility: hidden !important;
  transition: opacity 0.3s ease, visibility 0.3s ease !important;

  &.show {
    opacity: 1 !important;
    visibility: visible !important;

    .custom-modal-dialog {
      transform: scale(1) !important;
    }
  }

  &.closing {
    opacity: 0 !important;

    .custom-modal-dialog {
      transform: scale(0.9);
    }
  }
}

body .custom-modal-backdrop {
  position: absolute !important;
  top: 0 !important;
  left: 0 !important;
  width: 100% !important;
  height: 100% !important;
  background-color: rgba(0, 0, 0, 0.5) !important;
  cursor: pointer !important;
}

body .custom-modal-dialog {
  position: relative !important;
  width: 90% !important;
  max-width: 500px !important;
  max-height: 90vh !important;
  transform: scale(0.9) !important;
  transition: transform 0.3s ease !important;
  z-index: 1061 !important; // Higher than backdrop
}

body .custom-modal-content {
  position: relative !important;
  display: flex !important;
  flex-direction: column !important;
  background-color: #fff !important;
  border: 1px solid rgba(0, 0, 0, 0.175) !important;
  border-radius: 0.5rem !important;
  box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
  overflow: hidden !important;

  [data-bs-theme="dark"] & {
    background-color: #2a2a2a !important;
    border-color: #495057 !important;
    color: #fff !important;
  }
}

.custom-modal-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1rem;
  border-bottom: 1px solid #dee2e6;

  [data-bs-theme="dark"] & {
    border-bottom-color: #495057;
  }
}

.custom-modal-title {
  margin: 0;
  font-size: 1.25rem;
  font-weight: 500;
  line-height: 1.2;
}

.custom-modal-close {
  background: none;
  border: none;
  font-size: 1.5rem;
  font-weight: 700;
  line-height: 1;
  color: #000;
  opacity: 0.5;
  cursor: pointer;
  padding: 0;
  width: 1.5rem;
  height: 1.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: opacity 0.15s ease;

  &:hover {
    opacity: 0.75;
  }

  [data-bs-theme="dark"] & {
    color: #fff;
  }
}

.custom-modal-body {
  position: relative;
  flex: 1 1 auto;
  padding: 1rem;
  max-height: 60vh;
  overflow-y: auto;
}

.custom-modal-footer {
  display: flex;
  align-items: center;
  justify-content: flex-end;
  gap: 0.5rem;
  padding: 1rem;
  border-top: 1px solid #dee2e6;

  [data-bs-theme="dark"] & {
    border-top-color: #495057;
  }
}

// Cursor pointer utility
.cursor-pointer {
  cursor: pointer;
}

// Button group improvements
.btn-group-sm .btn {
  font-size: 0.775rem;
}

// Responsive improvements
@media (max-width: 768px) {
  #toolbar {
    flex-wrap: wrap;

    .navbar-brand {
      font-size: 1rem;
    }

    .dropdown, .btn-sm {
      font-size: 0.875rem;
    }

    // Stack controls vertically on mobile
    .d-flex.justify-content-between {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.5rem;
      width: 100%;

      #previewControls {
        margin-right: 0;
        width: 100%;
        justify-content: flex-end;
      }
    }
  }

  #main {
    flex-direction: column;

    #editorContainer {
      flex: 0 0 50%;
    }

    #previewContainer {
      flex: 0 0 50%;
    }
  }

  .document-item {
    .btn-group {
      flex-direction: column;
      gap: 0.25rem;
    }
  }
}

// ─── TOOLBAR LAYOUT IMPROVEMENTS ───
#toolbar {
  .navbar-brand {
    white-space: nowrap;
  }

  #documentTitle {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 200px;
  }
}

// Align preview controls with the preview div
#previewControls {
  // Calculate the right margin to align with preview div
  // This takes into account the padding and position of the preview container
  margin-right: calc(1rem); // Match the previewContainer padding
}

// User profile dropdown button styling (no border)
#userMenuDropdown {
  border: none !important;
  background: transparent !important;
  color: inherit;

  &:hover {
    background-color: rgba(0, 0, 0, 0.05) !important;
    border: none !important;
  }

  &:focus {
    box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
    outline: none;
    border: none !important;
    background: transparent !important;
  }

  &:active,
  &.show {
    background: transparent !important;
    border: none !important;
    box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
  }

  [data-bs-theme="dark"] & {
    &:hover {
      background-color: rgba(255, 255, 255, 0.1) !important;
    }
  }
}

// ─── RESPONSIVE FLEX BEHAVIOR OVERRIDE ───
// Fix for when window size decreases - allow panels to shrink proportionally
@media screen and (min-width: 769px) {
  #main {
    #editorContainer {
      flex: 0 1 40% !important;  // Allow shrinking while maintaining proportion
      min-width: 250px;          // Minimum width before mobile layout kicks in
    }

    #previewContainer {
      flex: 0 1 60% !important;  // Allow shrinking while maintaining proportion
      min-width: 250px;          // Minimum width before mobile layout kicks in
    }
  }
}

// Ensure Monaco editor can shrink properly
#editor {
  min-width: 0 !important;
  width: 100% !important;
}

// Ensure preview content can shrink
#preview, .preview-scroll {
  min-width: 0 !important;
  width: 100% !important;
}